@using Microsoft.AspNetCore.Components.Forms

@typeparam T where T : class, new()
@inherits FlowTabDocumentBase<T>

@if (DynamicModel == null)
{
    <Loading Message="Loading..."/>
}
else
{
    @if(@Alert == null)
    {
        <EditForm EditContext="CurrentEditContext">
            <FluentValidationValidator />
            <MudToolBar DisableGutters="true">
                @if(!isReadOnly)
                {
                    @if (isSaveInProgress)
                    {
                        <MudProgressCircular Color="Color.Default" Indeterminate="true" />
                    }
                    else if (!isDeleteInProgress)
                    {
                        <MudTooltip Text="Save" Arrow="true">
                            <MudIconButton ButtonType="ButtonType.Button" OnClick="@SubmitAsync" Color="Color.Inherit" Icon="@Icons.Material.Filled.Save"/>
                        </MudTooltip>
                    }
                }

                <MudText Typo="Typo.h6">@DynamicModel.Title @DynamicModel.Id</MudText>

                <ValidationBadge Title="@DynamicModel.Title" Messages="@messages" />

                <MudSpacer />

                @if(!isReadOnly)
                {               
                    @if (isDeleteInProgress)
                    {
                        <MudProgressCircular Color="Color.Default" Indeterminate="true" />
                    }
                    else if (!isSaveInProgress)
                    {
                        <MudTooltip Text="Delete" Arrow="true">
                            <MudIconButton Color="Color.Inherit" Icon="@Icons.Material.Filled.Delete" OnClick="DeleteAsync" />
                        </MudTooltip>
                    }
                }
            </MudToolBar>
            <MudTabs Elevation="1" Rounded="true" ApplyEffectsToContainer="true">
                @foreach (var page in DynamicModel.RootContainers)
                {
                    <MudTabPanel Text="@(page.Label)" OnClick=@(() => SetActivePage(page))/>
                }
            </MudTabs>
            @if(activePage != null)
            {
                if (activePage.DynamicComponent.IsGenericType)
                {
                    @RenderFlowListItemContainer()
                }
                else
                {
                    <DynamicComponent @key=activePage.ContainerId Type="activePage.DynamicComponent" Parameters="activePage.Parameters" />
                }
            }
        </EditForm>
    }
    else
    {
        <Alert AlertType="@Alert.AlertType" Title="@Alert.Title" Message="@Alert.Message" />
    }
}